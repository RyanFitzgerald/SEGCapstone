/*!
 * Name: tagselector.js
 * Author: Ryan Fitzgerald
 * Version: 0.0.3
 * Repo: https://github.com/RyanFitzgerald/tagselector
 * Issues: https://github.com/RyanFitzgerald/tagselector/issues
 * License: MIT
 */
!function(t,e){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(function(){return e()}):t.TagSelector=e()}(this,function(){"use strict";function t(t,i){var n=i||{};this.target=document.getElementById(t)||!1,this.selected=[],this.options=r(this.target),this.wrapper=document.createElement("div"),this.wrapper.className="tagselector-wrap",this.target&&"SELECT"===this.target.tagName?(this.settings=s(e,n),this.init()):console.error("Error: Must provide a valid ID for select field")}var e={max:!1,onInit:!1,onDestroy:!1,onSelect:!1,onDeselect:!1},s=function(t,e){if("object"==typeof e){var s={};return Object.keys(t).forEach(function(i){e[i]?s[i]=e[i]:s[i]=t[i]}),s}},i=function(t,e){e.parentNode.insertBefore(t,e.nextSibling)},n=function(t,e){return(""+t.className).indexOf(" "+e)>-1},o=function(t,e){t.className=t.className.replace(e,"")},r=function(t){for(var e=t.options,s={},i=0;i<e.length;i++)s[e[i].value]={text:e[i].text,index:i,selected:e[i].selected};return s};return t.prototype.init=function(){var t=this.options,e=this.selected,s=this.wrapper,n=this.tagListener.bind(this);this.target.setAttribute("multiple",!0),this.target.style.display="none",i(this.wrapper,this.target),Object.keys(t).forEach(function(i,o){var r=document.createElement("span");r.className="tagselector-tag",r.innerHTML=t[i].text,r.dataset.tagkey=i,r.dataset.tag=o,t[i].selected&&(r.className+=" active",e.push(i)),n(r),s.appendChild(r)}),this.settings.onInit&&"function"==typeof this.settings.onInit&&this.settings.onInit()},t.prototype.tagListener=function(t){var e=this.target,s=this.options,i=this.selected,r=this.settings,a=this.wrapper;t.addEventListener("click",function(){var t=this.dataset.tagkey,c=s[t].index;if(n(this,"active")){o(this," active");var l=i.indexOf(t);l>-1&&i.splice(l,1),e.options[c].selected=!1,r.onDeselect&&"function"==typeof r.onDeselect&&r.onDeselect(t,s[t].text)}else if(this.className+=" active",i.push(t),e.options[c].selected=!0,r.onSelect&&"function"==typeof r.onSelect&&r.onSelect(t,s[t].text),r.max&&i.length>r.max){var p=s[i[0]].index;e.options[p].selected=!1,o(a.querySelector('.active[data-tagkey="'+i[0]+'"]')," active"),i.shift(),r.onDeselect&&"function"==typeof r.onDeselect&&r.onDeselect(i[0],s[i[0]].text)}})},t.prototype.destroy=function(){this.options=null,this.selected=null,this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null,this.target.style.display="initial",this.target=null,this.settings.onDestroy&&"function"==typeof this.settings.onDestroy&&this.settings.onDestroy(),this.settings=null},t.prototype.reload=function(){this.options=null,this.selected=[],this.wrapper.parentNode.removeChild(this.wrapper),this.options=r(this.target),this.wrapper=document.createElement("div"),this.wrapper.className="tagselector-wrap",this.init()},t});